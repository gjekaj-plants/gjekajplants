<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gjekaj Plants ‚Äî Katalogu i Bim√´ve</title>

  <meta name="description" content="Gjekaj Plants ‚Äî pem√´ dekorative, bim√´, fidane dhe shkurre n√´ Daj√ß, Shkod√´r. Shiko katalogun, filtro sipas emrit/kategoris√´/kodit dhe d√´rgo porosin√´ n√´ WhatsApp." />
  <meta name="keywords" content="Gjekaj Plants, katalog bim√´sh, pem√´ dekorative, bim√´ dekorative, fidane, shkurre dekorative, Daj√ß, Shkod√´r, √ßmime lek, √ßmime euro, porosi WhatsApp" />

  <!-- Open Graph (p√´r Facebook/WhatsApp preview) -->
  <meta property="og:title" content="Gjekaj Plants ‚Äî Katalogu i Bim√´ve" />
  <meta property="og:description" content="Pem√´ dekorative, bim√´, fidane dhe shkurre. K√´rko, filtro dhe d√´rgo porosin√´ n√´ WhatsApp." />
  <meta property="og:type" content="website" />

  <!-- Theme color -->
  <meta name="theme-color" content="#111827" />

  <style>
    :root{
      --bg:#ffffff;              /* sfond i bardh */
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --accent:#b91c1c;          /* cmimet te kuqe */
      --border:#e5e7eb;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header{
      background: linear-gradient(180deg, #0b1220 0%, #111827 100%);
      color:#fff;
      padding: 22px 16px 18px;
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom: 1px solid rgba(255,255,255,.08);
      text-align:center;
    }
    header h1{
      margin:0;
      font-size: clamp(20px, 3.6vw, 32px);
      font-weight: 900;
      line-height: 1.15;
    }
    header .sub{
      margin-top:8px;
      opacity:.9;
      font-size: 14px;
      font-weight: 650;
    }

    .wrap{
      max-width: 1200px;
      margin: 18px auto 90px;
      padding: 0 14px;
    }

    .panel{
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 14px;
      margin-top: 14px;
    }

    .grid-controls{
      display:grid;
      grid-template-columns: 1.3fr .8fr .9fr;
      gap: 10px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid-controls{ grid-template-columns: 1fr; }
    }

    label{
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      display:block;
      margin: 6px 0 6px;
    }
    input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border:1px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      outline: none;
      background:#fff;
    }
    textarea{ min-height: 70px; resize: vertical; }

    .bar{
      display:flex;
      justify-content: space-between;
      align-items:center;
      margin-top: 14px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .count{
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
    }
    .status{
      font-size: 13px;
      font-weight: 900;
      color: var(--muted);
    }
    .error{
      display:none;
      margin-top: 14px;
      background: #fff;
      border: 1px solid #fecaca;
      border-left: 6px solid #b91c1c;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 900;
      color:#7f1d1d;
      white-space: pre-wrap;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 1020px){ .cards{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 640px){ .cards{grid-template-columns: 1fr;} }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 100%;
    }
    .img{
      width:100%;
      aspect-ratio: 16/10;
      background: #e5e7eb;
      display:block;
      object-fit: cover;
    }
    .content{
      padding: 12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      flex:1;
    }
    .name{
      margin:0;
      font-size: 20px;
      font-weight: 950;
      text-transform: none;
    }
    .meta{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      font-weight: 700;
    }
    .price{
      display:flex;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
    }
    .lek{
      color: var(--accent);     /* e kuqe */
      font-weight: 1000;
      font-size: 26px;
    }
    .eur{
      color: #111827;
      font-weight: 950;
      font-size: 18px;
    }
    .desc{
      color:#334155;
      font-size: 13px;
      line-height:1.35;
      font-weight: 650;
      opacity:.95;
    }
    .buyrow{
      display:flex;
      gap: 10px;
      align-items:center;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .qty{ width: 90px; }

    .btnAdd{
      flex:1;
      min-width: 160px;
      background: #111827;      /* butoni i zi */
      color: #fff;
      border: 0;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1000;
      cursor:pointer;
      font-size: 15px;
    }

    .rateCartCol{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .cartbox{
      background:#0b1220;
      color:#fff;
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 16px 45px rgba(2,6,23,.18);
    }
    .rateCartCol .cartbox{
      position: sticky;
      top: 96px;
      max-height: calc(100vh - 140px);
      overflow: auto;
      z-index: 40;
    }

    .cartbox h2{
      margin: 4px 0 10px;
      font-size: 16px;
      font-weight: 1000;
    }
    .cartlist{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .cartitem{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 10px;
      display:grid;
      grid-template-columns: 1fr 86px;
      gap: 10px;
      align-items:start;
    }
    .cartitem .t{ font-weight: 1000; font-size: 13.5px; }
    .cartitem .s{ margin-top: 4px; font-size: 12.5px; opacity:.9; }
    .cartitem .q{ display:flex; flex-direction:column; gap: 8px; }
    .cartitem input{
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight: 1000;
      text-align:center;
    }
    .btnDel{
      width:100%;
      border:0;
      border-radius: 12px;
      padding: 10px 10px;
      cursor:pointer;
      font-weight: 1000;
      background: rgba(244,63,94,.22);
      color:#fff;
    }

    .totals{
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }
    .totals .big{ font-size: 20px; font-weight: 1100; }
    .totals .small{ font-size: 14px; font-weight: 1000; opacity:.95; }

    .note{ margin-top: 10px; }
    .note textarea{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color:#fff;
    }

    .cartActions{
      display:flex;
      gap: 10px;
      margin-top: 10px;
    }
    .btnClear{
      width: 100%;
      background: rgba(255,255,255,.10);
      color:#fff;
      border:1px solid rgba(255,255,255,.20);
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1100;
      cursor:pointer;
      font-size: 15px;
    }
    .send{
      margin-top: 10px;
      width:100%;
      background:#16a34a;
      color:#fff;
      border:0;
      border-radius: 14px;
      padding: 13px 12px;
      font-weight: 1100;
      cursor:pointer;
      font-size: 16px;
    }
    .send:disabled{ opacity:.55; cursor:not-allowed; }

    footer{
      position: fixed;
      left:0; right:0; bottom:0;
      background: #111827;
      color:#fff;
      padding: 10px 14px;
      text-align:center;
      font-weight: 1000;
      z-index: 40;
    }
  </style>
</head>

<body>
  <header>
    <h1>Gjekaj Plants ‚Äî Katalogu i Bim√´ve</h1>
    <div class="sub">Daj√ß, Shkod√´r, Albania ‚Ä¢ Tel: +355697232425</div>
  </header>

  <div class="wrap">
    <div id="err" class="error"></div>

    <div class="panel">
      <div class="grid-controls">
        <div>
          <label>K√´rko (em√´r / kategori / kod)</label>
          <input id="q" placeholder="p.sh. cipresus, 019, dekorative..." />
        </div>

        <div>
          <label>Kategori</label>
          <select id="cat">
            <option value="">T√´ gjitha kategorit√´</option>
          </select>
        </div>

        <div class="rateCartCol">
          <div>
            <label>Kursi ‚Ç¨ ‚Üí Lek (1‚Ç¨ = 97)</label>
            <input id="rate" type="number" inputmode="numeric" min="1" step="1" value="97" />
          </div>

          <div class="cartbox" id="cartBox">
            <h2>Shporta</h2>
            <div id="cartItems" class="cartlist"></div>

            <div class="totals">
              <div class="big" id="cartTotalLek">0 Lek√´</div>
              <div class="small" id="cartTotalEur">0.00 ‚Ç¨</div>
            </div>

            <div class="note">
              <label style="color: rgba(255,255,255,.85); font-weight:1000">Sh√´nim (opsionale)</label>
              <textarea id="note" placeholder="p.sh. d√´rges√´ / orari / k√´rkesa speciale..."></textarea>
            </div>

            <div class="cartActions">
              <button id="clearCart" class="btnClear" type="button">Pastro shport√´n</button>
            </div>

            <button id="sendWA" class="send" disabled>D√´rgo n√´ WhatsApp</button>
          </div>
        </div>
      </div>

      <div class="bar">
        <div class="count" id="count">0 artikuj</div>
        <div class="status" id="status">Duke u lidhur‚Ä¶</div>
      </div>
    </div>

    <div class="cards" id="cards"></div>
  </div>

  <footer>Gjekaj Plants ‚Ä¢ WhatsApp: 0697232425</footer>

  <script>
    // =========================
    //  SUPABASE (REST / PostgREST) ‚Äì pa librari
    // =========================
    var SUPABASE_URL = "https://oehcfyfjlwvlqowjezwg.supabase.co";
    // ‚ö†Ô∏è VENDOS KETU "Anon Key (Legacy)" (jo sb_publishable)
    var SUPABASE_ANON_KEY = "VENDOS_ANON_KEY_LEGACY_KETU";
    var TABLE_NAME = "products";
    var SCHEMA = "public";

    // Kolonat
    var COL_CATEGORY = "category";
    var COL_CODE     = "code";
    var COL_STOCK    = "stock";
    var COL_PRICELEK = "price_lek";

    var NAME_KEYS = ["name","title","emri"];
    var DESC_KEYS = ["description","desc","pershkrimi","pershkrim"];
    var IMG_KEYS  = ["photo_url","image_url","img_url","photo","image","foto","url_photo","url_image"];

    var WHATSAPP_NUMBER = "355697232425"; // pa +

    // UI
    var elErr = document.getElementById("err");
    var elCards = document.getElementById("cards");
    var elCount = document.getElementById("count");
    var elStatus = document.getElementById("status");
    var elQ = document.getElementById("q");
    var elCat = document.getElementById("cat");
    var elRate = document.getElementById("rate");

    var cartItemsEl = document.getElementById("cartItems");
    var cartTotalLekEl = document.getElementById("cartTotalLek");
    var cartTotalEurEl = document.getElementById("cartTotalEur");
    var noteEl = document.getElementById("note");
    var clearCartBtn = document.getElementById("clearCart");
    var sendWA = document.getElementById("sendWA");

    function showError(msg){
      elErr.style.display = "block";
      elErr.textContent = msg;
    }
    function clearError(){
      elErr.style.display = "none";
      elErr.textContent = "";
    }
    function firstExisting(row, keys){
      for (var i=0;i<keys.length;i++){
        var k = keys[i];
        if (row && row[k] !== undefined && row[k] !== null && String(row[k]).replace(/^\s+|\s+$/g,'') !== "") return row[k];
      }
      return "";
    }
    function escapeHtml(s){
      s = String(s === undefined || s === null ? "" : s);
      return s
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }
    function toNumber(v){
      if (v === null || v === undefined) return 0;
      var s = String(v);
      s = s.replace(/\./g,"").replace(/,/g,".");
      s = s.replace(/[^\d.]/g,"");
      var n = Number(s);
      return isFinite(n) ? n : 0;
    }
    function formatLek(n){
      var x = Math.round(n);
      return String(x).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
    function formatEuro(n){
      return (Math.round(n * 100) / 100).toFixed(2);
    }

    // Data
    var ALL = [];
    var CART = {}; // {id: {row, qty}}

    function saveCart(){
      try{
        localStorage.setItem("gjekaj_cart_v3", JSON.stringify({ cart: CART, note: noteEl.value || "" }));
      }catch(e){}
    }
    function loadCart(){
      try{
        var raw = localStorage.getItem("gjekaj_cart_v3");
        if (!raw) return;
        var obj = JSON.parse(raw);
        CART = (obj && obj.cart) ? obj.cart : {};
        noteEl.value = (obj && obj.note) ? obj.note : "";
      }catch(e){}
    }

    function buildCategories(rows){
      var set = {};
      for (var i=0;i<rows.length;i++){
        var r = rows[i];
        var c = (r && r[COL_CATEGORY]) ? String(r[COL_CATEGORY]).replace(/^\s+|\s+$/g,'') : "";
        if (c) set[c] = true;
      }
      var cats = [];
      for (var k in set) cats.push(k);
      cats.sort(function(a,b){ return a.localeCompare(b); });

      var current = elCat.value;
      var html = '<option value="">T√´ gjitha kategorit√´</option>';
      for (var j=0;j<cats.length;j++){
        html += '<option value="'+escapeHtml(cats[j])+'">'+escapeHtml(cats[j])+'</option>';
      }
      elCat.innerHTML = html;
      // ruaj selection nqs ekziston
      for (var t=0;t<cats.length;t++){
        if (cats[t] === current) { elCat.value = current; break; }
      }
    }

    function calcTotals(){
      var rate = Math.max(1, toNumber(elRate.value || 97));
      var totalLek = 0;

      for (var id in CART){
        if (!CART.hasOwnProperty(id)) continue;
        var it = CART[id];
        var priceLek = toNumber(it && it.row ? it.row[COL_PRICELEK] : 0);
        var qty = Math.max(1, toNumber(it.qty || 1));
        totalLek += priceLek * qty;
      }
      var totalEur = totalLek / rate;

      cartTotalLekEl.textContent = formatLek(totalLek) + " Lek√´";
      cartTotalEurEl.textContent = formatEuro(totalEur) + " ‚Ç¨";

      sendWA.disabled = totalLek <= 0;
      saveCart();
      return { totalLek: totalLek, totalEur: totalEur, rate: rate };
    }

    function renderCart(){
      var ids = [];
      for (var id in CART){ if (CART.hasOwnProperty(id)) ids.push(id); }

      if (ids.length === 0){
        cartItemsEl.innerHTML = '<div style="opacity:.9;font-weight:900;">Shporta √´sht√´ bosh.</div>';
        calcTotals();
        return;
      }

      var out = "";
      for (var i=0;i<ids.length;i++){
        var cid = ids[i];
        var it = CART[cid];
        var r = it.row || {};
        var name = firstExisting(r, NAME_KEYS) || "(pa em√´r)";
        var category = r[COL_CATEGORY] ? String(r[COL_CATEGORY]) : "";
        var code = r[COL_CODE] ? String(r[COL_CODE]) : "";
        var priceLek = toNumber(r[COL_PRICELEK]);
        var qty = Math.max(1, toNumber(it.qty || 1));

        out += ''
          + '<div class="cartitem">'
          + '  <div>'
          + '    <div class="t">'+escapeHtml(name)+'</div>'
          + '    <div class="s">'
          + (category ? 'Kategoria: <b>'+escapeHtml(category)+'</b><br>' : '')
          + (code ? 'Kodi: <b>'+escapeHtml(code)+'</b><br>' : '')
          + '√ámimi: <b>'+formatLek(priceLek)+' Lek√´</b>'
          + '    </div>'
          + '  </div>'
          + '  <div class="q">'
          + '    <input type="number" min="1" step="1" value="'+qty+'" data-id="'+escapeHtml(cid)+'" class="qtyInCart" />'
          + '    <button class="btnDel" data-del="'+escapeHtml(cid)+'">Hiq</button>'
          + '  </div>'
          + '</div>';
      }
      cartItemsEl.innerHTML = out;

      var inps = cartItemsEl.querySelectorAll(".qtyInCart");
      for (var a=0;a<inps.length;a++){
        (function(inp){
          inp.addEventListener("input", function(){
            var id = inp.getAttribute("data-id");
            var v = Math.max(1, toNumber(inp.value || 1));
            if (CART[id]) CART[id].qty = v;
            calcTotals();
          });
        })(inps[a]);
      }

      var dels = cartItemsEl.querySelectorAll("[data-del]");
      for (var b=0;b<dels.length;b++){
        (function(btn){
          btn.addEventListener("click", function(){
            var id = btn.getAttribute("data-del");
            try{ delete CART[id]; }catch(e){}
            renderCart();
          });
        })(dels[b]);
      }

      calcTotals();
    }

    function addToCart(row, qty){
      var id = String((row && row.id) ? row.id : (row && row[COL_CODE]) ? row[COL_CODE] : firstExisting(row, NAME_KEYS));
      var q = Math.max(1, toNumber(qty || 1));

      if (!CART[id]) CART[id] = { row: row, qty: q };
      else CART[id].qty = Math.max(1, toNumber(CART[id].qty || 1) + q);

      renderCart();
    }

    function renderProducts(){
      clearError();

      var q = String(elQ.value || "").replace(/^\s+|\s+$/g,'').toLowerCase();
      var cat = String(elCat.value || "").replace(/^\s+|\s+$/g,'');
      var rate = Math.max(1, toNumber(elRate.value || 97));

      var filtered = [];
      for (var i=0;i<ALL.length;i++){
        var r = ALL[i];

        if (cat && String(r[COL_CATEGORY] || "").replace(/^\s+|\s+$/g,'') !== cat) continue;

        if (!q){
          filtered.push(r);
          continue;
        }

        var name = String(firstExisting(r, NAME_KEYS) || "").toLowerCase();
        var category = String(r[COL_CATEGORY] || "").toLowerCase();
        var code = String(r[COL_CODE] || "").toLowerCase();

        if (name.indexOf(q) !== -1 || category.indexOf(q) !== -1 || code.indexOf(q) !== -1){
          filtered.push(r);
        }
      }

      elCount.textContent = filtered.length + " artikuj";

      var html = "";
      for (var j=0;j<filtered.length;j++){
        var row = filtered[j];
        var name2 = firstExisting(row, NAME_KEYS) || "(pa em√´r)";
        var desc = firstExisting(row, DESC_KEYS) || "";
        var img = firstExisting(row, IMG_KEYS) || "";
        var category2 = row[COL_CATEGORY] ? String(row[COL_CATEGORY]) : "";
        var code2 = row[COL_CODE] ? String(row[COL_CODE]) : "";
        var stock = row[COL_STOCK] ? String(row[COL_STOCK]) : "";

        var priceLek = toNumber(row[COL_PRICELEK]);
        var priceEur = priceLek / rate;

        var pid = escapeHtml(String((row && row.id) ? row.id : (code2 ? code2 : name2)));

        var imgTag = img
          ? '<img class="img" src="'+escapeHtml(img)+'" alt="'+escapeHtml(name2)+'" loading="lazy" onerror="this.style.display=\'none\'; this.parentNode.style.background=\'#e5e7eb\';" />'
          : '<div class="img"></div>';

        html += ''
          + '<article class="card">'
          + imgTag
          + '<div class="content">'
          + '  <h3 class="name">'+escapeHtml(name2)+'</h3>'
          + '  <div class="meta">'
          + (category2 ? 'Kategoria: <b>'+escapeHtml(category2)+'</b><br>' : '')
          + (code2 ? 'Kodi: <b>'+escapeHtml(code2)+'</b><br>' : '')
          + (stock ? 'Stok: <b>'+escapeHtml(stock)+'</b>' : '')
          + '  </div>'
          + '  <div class="price">'
          + '    <div class="lek">'+formatLek(priceLek)+' Lek√´</div>'
          + '    <div class="eur">'+formatEuro(priceEur)+' ‚Ç¨</div>'
          + '  </div>'
          + (desc ? '<div class="desc">'+escapeHtml(desc)+'</div>' : '')
          + '  <div class="buyrow">'
          + '    <input class="qty" type="number" min="1" step="1" value="1" id="qty_'+pid+'" />'
          + '    <button class="btnAdd" data-add="'+pid+'">Shto n√´ shport√´</button>'
          + '  </div>'
          + '</div>'
          + '</article>';
      }

      elCards.innerHTML = html;

      var btns = elCards.querySelectorAll("[data-add]");
      for (var k=0;k<btns.length;k++){
        (function(btn){
          btn.addEventListener("click", function(){
            var pid = btn.getAttribute("data-add");
            var qtyEl = document.getElementById("qty_" + pid);
            var qty = Math.max(1, toNumber(qtyEl ? qtyEl.value : 1));

            var row = null;
            for (var i=0;i<filtered.length;i++){
              var r = filtered[i];
              var rid = String(r.id || "");
              var rcode = String(r[COL_CODE] || "");
              var rname = String(firstExisting(r, NAME_KEYS) || "");
              if ((rid && rid === pid) || (rcode && rcode === pid) || (rname && rname === pid)){
                row = r; break;
              }
            }
            if (row) addToCart(row, qty);
          });
        })(btns[k]);
      }

      calcTotals();
    }

    function buildWhatsAppMessage(){
      var totals = calcTotals();
      var totalLek = totals.totalLek, totalEur = totals.totalEur, rate = totals.rate;
      var note = String(noteEl.value || "").replace(/^\s+|\s+$/g,'');

      var lines = [];
      lines.push("üìå K√´rkes√´ nga Katalogu ‚Äî Gjekaj Plants");
      lines.push("");

      for (var id in CART){
        if (!CART.hasOwnProperty(id)) continue;
        var it = CART[id];
        var r = it.row || {};
        var name = firstExisting(r, NAME_KEYS) || "(pa em√´r)";
        var code = r[COL_CODE] ? String(r[COL_CODE]) : "";
        var priceLek = toNumber(r[COL_PRICELEK]);
        var qty = Math.max(1, toNumber(it.qty || 1));
        var subLek = priceLek * qty;
        var subEur = subLek / rate;

        lines.push("‚Ä¢ " + name + (code ? " (Kodi: " + code + ")" : ""));
        lines.push("  Sasia: " + qty + " | N√´n-total: " + formatLek(subLek) + " Lek√´ (" + formatEuro(subEur) + " ‚Ç¨)");
      }

      lines.push("");
      lines.push("Totali: " + formatLek(totalLek) + " Lek√´ (" + formatEuro(totalEur) + " ‚Ç¨)");
      lines.push("Kursi: 1‚Ç¨ = " + rate + " Lek");

      if (note){
        lines.push("");
        lines.push("Sh√´nim:");
        lines.push(note);
      }
      return lines.join("\n");
    }

    // =========================
    //  LOAD from Supabase REST
    // =========================
    function supabaseRestUrl(){
      // PostgREST endpoint
      // shembull: https://xxx.supabase.co/rest/v1/products?select=*
      return SUPABASE_URL + "/rest/v1/" + encodeURIComponent(TABLE_NAME) + "?select=*";
    }

    function load(){
      clearError();
      elStatus.textContent = "Duke lexuar nga Supabase‚Ä¶";

      if (!SUPABASE_ANON_KEY || SUPABASE_ANON_KEY.indexOf("VENDOS_") === 0){
        showError("Vendos ANON KEY (Legacy) te variabla SUPABASE_ANON_KEY dhe b√´j commit n√´ GitHub.");
        elStatus.textContent = "Gabim";
        return;
      }

      var url = supabaseRestUrl();

      fetch(url, {
        method: "GET",
        headers: {
          "apikey": SUPABASE_ANON_KEY,
          "Authorization": "Bearer " + SUPABASE_ANON_KEY,
          "Accept": "application/json"
        }
      })
      .then(function(res){
        if (!res.ok){
          return res.text().then(function(t){
            throw new Error("HTTP " + res.status + " ‚Äî " + t);
          });
        }
        return res.json();
      })
      .then(function(data){
        ALL = Array.isArray(data) ? data : [];
        buildCategories(ALL);
        renderProducts();
        elStatus.textContent = "Gati.";
      })
      .catch(function(e){
        showError("Nuk u lidhe me Supabase.\nKontrollo:\n1) RLS policy SELECT p√´r anon/public\n2) TABLE: public.products\n3) Key: p√´rdor Anon Key (Legacy)\n\nMesazh: " + (e && e.message ? e.message : e));
        elStatus.textContent = "Gabim";
      });
    }

    // Events
    elQ.addEventListener("input", renderProducts);
    elCat.addEventListener("change", renderProducts);
    elRate.addEventListener("input", function(){ renderProducts(); renderCart(); });
    noteEl.addEventListener("input", saveCart);

    clearCartBtn.addEventListener("click", function(){
      if (!confirm("Me e pastru shport√´n komplet?")) return;
      CART = {};
      noteEl.value = "";
      renderCart();
    });

    sendWA.addEventListener("click", function(){
      var msg = buildWhatsAppMessage();
      var url = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(msg);
      window.open(url, "_blank");
    });

    // Start
    loadCart();
    renderCart();
    load();
  </script>
</body>
</html>
