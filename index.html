<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Fidan & PemÃ« Dekorative nÃ« DajÃ§, ShkodÃ«r | Gjekaj Plants</title>
  <meta name="description" content="Gjekaj Plants nÃ« DajÃ§, ShkodÃ«r â€“ fidan dekorative, pemÃ« dekorative, lule dekorative, shkurre dhe bimÃ« pÃ«r oborr e kopÃ«sht. Shiko katalogun online dhe porosit nÃ« WhatsApp." />
  <meta name="keywords" content="fidan dekorative,pemÃ« dekorative,lule dekorative,fidan DajÃ§,fidan ShkodÃ«r,pemÃ« dekorative DajÃ§,pemÃ« dekorative ShkodÃ«r,bimÃ« dekorative,fidane pemÃ«sh,kopshtari ShkodÃ«r,Gjekaj Plants" />
  <meta name="author" content="Gjekaj Plants, DajÃ§ ShkodÃ«r" />
  <meta name="robots" content="index, follow" />
  <meta name="language" content="sq" />

  <!-- Open Graph (pÃ«r shpÃ«rndarje nÃ« FB/WhatsApp) -->
  <meta property="og:title" content="Fidan & PemÃ« Dekorative nÃ« DajÃ§, ShkodÃ«r | Gjekaj Plants" />
  <meta property="og:description" content="Katalog online me fidan dekorative, pemÃ« dekorative, lule dekorative dhe bimÃ« pÃ«r oborr e kopÃ«sht. Porosit nÃ« WhatsApp." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg:#f3f5f8;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --accent:#b91c1c;
      --border:#e5e7eb;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --radius: 18px;
      --dark:#0b1220;
      --green:#16a34a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header{
      background: linear-gradient(180deg, #0b1220 0%, #111827 100%);
      color:#fff;
      padding: 22px 16px 18px;
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom: 1px solid rgba(255,255,255,.08);
      text-align:center;
    }
    header h1{
      margin:0;
      font-size: 26px;
      font-weight: 900;
      line-height: 1.15;
    }
    header .sub{
      margin-top:8px;
      opacity:.9;
      font-size: 14px;
      font-weight: 650;
    }

    .wrap{
      max-width: 1200px;
      margin: 18px auto 90px;
      padding: 0 14px;
    }

    .seo{
      max-width:1100px;
      margin: 16px auto 6px;
      padding: 0 2px;
      color:#334155;
      font-size:14px;
    }
    .seo h2{margin:0 0 8px;font-size:18px}
    .seo p{margin:0 0 10px;line-height:1.45}

    .panel{
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 14px;
      margin-top: 14px;
    }

    .grid-controls{
      display:grid;
      grid-template-columns: 1.3fr .8fr .9fr;
      grid-gap: 10px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid-controls{ grid-template-columns: 1fr; }
    }

    label{
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      display:block;
      margin: 6px 0 6px;
    }
    input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border:1px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      outline: none;
      background:#fff;
    }
    textarea{ min-height: 70px; resize: vertical; }

    .bar{
      display:flex;
      justify-content: space-between;
      align-items:center;
      margin-top: 14px;
      grid-gap: 10px;
      flex-wrap: wrap;
    }
    .count{
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
    }
    .status{
      font-size: 13px;
      font-weight: 900;
      color: var(--muted);
    }
    .error{
      display:none;
      margin-top: 14px;
      background: #fff;
      border: 1px solid #fecaca;
      border-left: 6px solid #b91c1c;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 900;
      color:#7f1d1d;
      white-space: pre-wrap;
    }

    /* Cards */
    .cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      grid-gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 1020px){ .cards{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 640px){ .cards{grid-template-columns: 1fr;} }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 100%;
    }
    .img{
      width:100%;
      height: 0;
      padding-top: 62.5%; /* 16/10 */
      background: #e5e7eb;
      position: relative;
      overflow:hidden;
    }
    .img img{
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .content{
      padding: 12px 12px 14px;
      display:flex;
      flex-direction:column;
      grid-gap: 8px;
      flex:1;
    }
    .nameRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      grid-gap:10px;
      flex-wrap:wrap;
    }
    .name{
      margin:0;
      font-size: 20px;
      font-weight: 950;
    }
    .badgeOffer{
      display:inline-block;
      background: var(--green);
      color:#fff;
      font-weight: 1000;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      letter-spacing:.3px;
    }

    .meta{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      font-weight: 700;
    }

    .price{
      display:flex;
      align-items: baseline;
      justify-content:space-between;
      grid-gap: 10px;
      flex-wrap: wrap;
    }
    .priceLeft{
      display:flex;
      align-items:baseline;
      grid-gap:10px;
      flex-wrap:wrap;
    }
    .lek{
      color: var(--accent);
      font-weight: 1000;
      font-size: 26px;
    }
    .eur{
      color: #334155;
      font-weight: 950;
      font-size: 18px;
    }
    .oldPrice{
      color:#64748b;
      font-weight:900;
      font-size: 14px;
      text-decoration: line-through;
      opacity:.95;
    }
    .discountPct{
      color: var(--green);
      font-weight: 1000;
      font-size: 14px;
      white-space:nowrap;
    }

    .desc{
      color:#334155;
      font-size: 13px;
      line-height:1.35;
      font-weight: 650;
      opacity:.95;
    }

    .buyrow{
      display:flex;
      grid-gap: 10px;
      align-items:center;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .qty{ width: 90px; }
    .btnAdd{
      flex:1;
      min-width: 160px;
      background: #111827;
      color: #fff;
      border: 0;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1000;
      cursor:pointer;
      font-size: 15px;
    }

    .rateCartCol{
      display:flex;
      flex-direction:column;
      grid-gap:10px;
    }

    /* Kursi vetÃ«m shfaqje */
    .rateWrap{
      display:flex;
      align-items:center;
      grid-gap:8px;
    }
    .rateWrap input{
      flex:1;
      background:#f8fafc;
    }
    .rateNote{
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      white-space:nowrap;
    }

    /* CART sticky */
    .cartbox{
      background: var(--dark);
      color:#fff;
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 16px 45px rgba(2,6,23,.18);
    }
    .rateCartCol .cartbox{
      position: sticky;
      top: 96px;
      max-height: calc(100vh - 140px);
      overflow: auto;
      z-index: 40;
    }
    .cartbox h2{
      margin: 4px 0 10px;
      font-size: 16px;
      font-weight: 1000;
    }
    .cartlist{
      display:flex;
      flex-direction:column;
      grid-gap: 10px;
    }
    .cartitem{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 10px;
      display:grid;
      grid-template-columns: 1fr 86px;
      grid-gap: 10px;
      align-items:start;
    }
    .cartitem .t{ font-weight: 1000; font-size: 13.5px; }
    .cartitem .s{ margin-top: 4px; font-size: 12.5px; opacity:.9; }
    .cartitem .q{ display:flex; flex-direction:column; grid-gap: 8px; }
    .cartitem input{
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight: 1000;
      text-align:center;
    }
    .btnDel{
      width:100%;
      border:0;
      border-radius: 12px;
      padding: 10px 10px;
      cursor:pointer;
      font-weight: 1000;
      background: rgba(244,63,94,.22);
      color:#fff;
    }

    .totals{
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      grid-gap: 10px;
    }
    .totals .big{ font-size: 20px; font-weight: 1100; }
    .totals .small{ font-size: 14px; font-weight: 1000; opacity:.95; }

    .note{ margin-top: 10px; }
    .note textarea{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color:#fff;
    }

    .cartActions{
      display:flex;
      grid-gap: 10px;
      margin-top: 10px;
    }
    .btnClear{
      width: 100%;
      background: rgba(255,255,255,.10);
      color:#fff;
      border:1px solid rgba(255,255,255,.20);
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1100;
      cursor:pointer;
      font-size: 15px;
    }
    .send{
      margin-top: 10px;
      width:100%;
      background:#16a34a;
      color:#fff;
      border:0;
      border-radius: 14px;
      padding: 13px 12px;
      font-weight: 1100;
      cursor:pointer;
      font-size: 16px;
    }
    .send:disabled{ opacity:.55; cursor:not-allowed; }

    footer{
      position: fixed;
      left:0; right:0; bottom:0;
      background: #111827;
      color:#fff;
      padding: 10px 14px;
      text-align:center;
      font-weight: 1000;
      z-index: 40;
    }
  </style>
</head>

<body>
  <header>
    <h1>Gjekaj Plants â€” Katalogu i BimÃ«ve</h1>
    <div class="sub">DajÃ§, ShkodÃ«r, Albania â€¢ Tel: +355697232425</div>
  </header>

  <div class="wrap">
    <section class="seo">
      <h2>Fidan dhe PemÃ« Dekorative nÃ« DajÃ§, ShkodÃ«r</h2>
      <p>
        Gjekaj Plants ofron fidan dekorative, pemÃ« dekorative, lule dekorative dhe bimÃ« pÃ«r oborr
        dhe kopshte nÃ« zonÃ«n e DajÃ§it dhe ShkodrÃ«s. Katalogu ynÃ« pÃ«rfshin fidane pemÃ«sh,
        shkurre dekorative dhe bimÃ« sezonale.
      </p>
    </section>

    <div id="err" class="error"></div>

    <div class="panel">
      <div class="grid-controls">
        <div>
          <label>KÃ«rko (emÃ«r / kategori / kod)</label>
          <input id="q" placeholder="p.sh. cipresus, 019, dekorative..." />
        </div>

        <div>
          <label>Kategori</label>
          <select id="cat">
            <option value="">TÃ« gjitha kategoritÃ«</option>
          </select>
        </div>

        <div class="rateCartCol">
          <div>
            <label>Kursi â‚¬ â†’ Lek (vetÃ«m shfaqje)</label>
            <div class="rateWrap">
              <input id="rate" type="number" value="97" readonly disabled />
              <div class="rateNote">default</div>
            </div>
          </div>

          <div class="cartbox" id="cartBox">
            <h2>Shporta</h2>
            <div id="cartItems" class="cartlist"></div>

            <div class="totals">
              <div class="big" id="cartTotalLek">0 LekÃ«</div>
              <div class="small" id="cartTotalEur">0.00 â‚¬</div>
            </div>

            <div class="note">
              <label style="color: rgba(255,255,255,.85); font-weight:1000">ShÃ«nim (opsionale)</label>
              <textarea id="note" placeholder="p.sh. dÃ«rgesÃ« / orari / kÃ«rkesa speciale..."></textarea>
            </div>

            <div class="cartActions">
              <button id="clearCart" class="btnClear" type="button">Pastro shportÃ«n</button>
            </div>

            <button id="sendWA" class="send" disabled>DÃ«rgo nÃ« WhatsApp</button>
          </div>
        </div>
      </div>

      <div class="bar">
        <div class="count" id="count">0 artikuj</div>
        <div class="status" id="status">Duke u lidhurâ€¦</div>
      </div>
    </div>

    <div class="cards" id="cards"></div>
  </div>

  <footer>Gjekaj Plants â€¢ WhatsApp: 0697232425</footer>

  <script>
    // =========================
    // âœ… SUPABASE SETTINGS (vendos vetÃ«m Ã§elÃ«sin)
    // =========================
    var SUPABASE_URL = "https://oehcfyfjlwvlqowjezwg.supabase.co";
    var SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9laGNmeWZqbHd2bHFvd2plendnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTU4NDEsImV4cCI6MjA4NTYzMTg0MX0.J3veeWRfwHhJOoMwBHwA2qQdQiXdqzGORDn8j0hR7Rk";

    // WhatsApp (pa +)
    var WHATSAPP_NUMBER = "355697232425";

    // Kolonat bazÃ«
    var COL_CATEGORY = "category";
    var COL_CODE     = "code";
    var COL_STOCK    = "stock";
    var COL_PRICELEK = "price_lek";

    // âœ… PÃ«r OFERTÃ‹: ruaje cmimin e vjetÃ«r nÃ« NJÃ‹ kolonÃ« (p.sh. old_price_lek)
    // Mund tâ€™i quash si tÃ« duash â€” kodi provon kÃ«to emra:
    var OLD_PRICE_KEYS = ["old_price_lek","price_old_lek","old_price","price_old","old_lek","oldprice_lek"];

    // Foto / EmÃ«r / PÃ«rshkrim (kodi i provon me radhÃ«)
    var IMG_KEYS  = ["photo_url","image_url","img_url","photo","image","foto","url_photo","url_image"];
    var NAME_KEYS = ["name","title","emri"];
    var DESC_KEYS = ["description","desc","pershkrimi","pershkrim"];

    // Kursi (vetÃ«m shfaqje)
    var DEFAULT_RATE = 97;

    // UI
    var elErr = document.getElementById("err");
    var elCards = document.getElementById("cards");
    var elCount = document.getElementById("count");
    var elStatus = document.getElementById("status");
    var elQ = document.getElementById("q");
    var elCat = document.getElementById("cat");
    var elRate = document.getElementById("rate");

    var cartItemsEl = document.getElementById("cartItems");
    var cartTotalLekEl = document.getElementById("cartTotalLek");
    var cartTotalEurEl = document.getElementById("cartTotalEur");
    var noteEl = document.getElementById("note");
    var clearCartBtn = document.getElementById("clearCart");
    var sendWA = document.getElementById("sendWA");

    // Helpers (ES5)
    function showError(msg){
      elErr.style.display = "block";
      elErr.textContent = msg;
    }
    function clearError(){
      elErr.style.display = "none";
      elErr.textContent = "";
    }
    function escapeHtml(s){
      s = (s === null || s === undefined) ? "" : String(s);
      return s
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }
    function firstExisting(row, keys){
      var i, k, v;
      for (i=0;i<keys.length;i++){
        k = keys[i];
        v = row ? row[k] : null;
        if (v !== undefined && v !== null && String(v).replace(/^\s+|\s+$/g,"") !== "") return v;
      }
      return "";
    }
    function toNumber(v){
      if (v === null || v === undefined) return 0;
      var s = String(v);
      // hiq pika si ndarÃ«s mijÃ«she, kthe presjen nÃ« pikÃ«
      s = s.replace(/\./g,"").replace(/,/g,".");
      s = s.replace(/[^\d.]/g,"");
      var n = Number(s);
      return (isFinite(n) ? n : 0);
    }
    function formatLek(n){
      var x = Math.round(n);
      var s = String(x);
      return s.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
    function formatEuro(n){
      var x = Math.round(n * 100) / 100;
      var s = x.toFixed(2);
      return s;
    }
    function safeTrim(s){
      return String(s || "").replace(/^\s+|\s+$/g,"");
    }

    // Data
    var ALL = [];
    var CART = {}; // {id: {row, qty}}

    function saveCart(){
      try{
        localStorage.setItem("gjekaj_cart_final", JSON.stringify({ cart: CART, note: noteEl.value || "" }));
      }catch(e){}
    }
    function loadCart(){
      try{
        var raw = localStorage.getItem("gjekaj_cart_final");
        if (!raw) return;
        var obj = JSON.parse(raw);
        CART = (obj && obj.cart) ? obj.cart : {};
        noteEl.value = (obj && obj.note) ? obj.note : "";
      }catch(e){}
    }

    function buildCategories(rows){
      var set = {};
      var i, r, c;
      for (i=0;i<rows.length;i++){
        r = rows[i] || {};
        c = safeTrim(r[COL_CATEGORY]);
        if (c) set[c] = true;
      }
      var cats = [];
      for (c in set) if (set.hasOwnProperty(c)) cats.push(c);
      cats.sort(function(a,b){ return a.localeCompare(b); });

      var current = elCat.value;
      var html = '<option value="">TÃ« gjitha kategoritÃ«</option>';
      for (i=0;i<cats.length;i++){
        html += '<option value="'+escapeHtml(cats[i])+'">'+escapeHtml(cats[i])+'</option>';
      }
      elCat.innerHTML = html;
      if (current) elCat.value = current;
    }

    function getOldPriceLek(row){
      var v = firstExisting(row, OLD_PRICE_KEYS);
      var n = toNumber(v);
      return n;
    }

    function calcTotals(){
      var rate = DEFAULT_RATE;
      var totalLek = 0;
      var id, it, priceLek, qty;

      for (id in CART) if (CART.hasOwnProperty(id)){
        it = CART[id];
        priceLek = toNumber(it && it.row ? it.row[COL_PRICELEK] : 0);
        qty = Math.max(1, toNumber(it && it.qty ? it.qty : 1));
        totalLek += priceLek * qty;
      }

      var totalEur = totalLek / rate;
      cartTotalLekEl.textContent = formatLek(totalLek) + " LekÃ«";
      cartTotalEurEl.textContent = formatEuro(totalEur) + " â‚¬";
      sendWA.disabled = totalLek <= 0;

      saveCart();
      return { totalLek: totalLek, totalEur: totalEur, rate: rate };
    }

    function renderCart(){
      var ids = [];
      var id;
      for (id in CART) if (CART.hasOwnProperty(id)) ids.push(id);

      if (ids.length === 0){
        cartItemsEl.innerHTML = '<div style="opacity:.9;font-weight:900;">Shporta Ã«shtÃ« bosh.</div>';
        calcTotals();
        return;
      }

      var html = "";
      var i, it, r, name, category, code, priceLek, qty;
      for (i=0;i<ids.length;i++){
        id = ids[i];
        it = CART[id];
        r = it.row || {};
        name = firstExisting(r, NAME_KEYS) || "(pa emÃ«r)";
        category = safeTrim(r[COL_CATEGORY]);
        code = safeTrim(r[COL_CODE]);
        priceLek = toNumber(r[COL_PRICELEK]);
        qty = Math.max(1, toNumber(it.qty || 1));

        html += ''
          + '<div class="cartitem">'
          + '  <div>'
          + '    <div class="t">'+escapeHtml(name)+'</div>'
          + '    <div class="s">'
          + (category ? ('Kategoria: <b>'+escapeHtml(category)+'</b><br>') : '')
          + (code ? ('Kodi: <b>'+escapeHtml(code)+'</b><br>') : '')
          + 'Ã‡mimi: <b>'+formatLek(priceLek)+' LekÃ«</b>'
          + '    </div>'
          + '  </div>'
          + '  <div class="q">'
          + '    <input type="number" min="1" step="1" value="'+qty+'" data-id="'+escapeHtml(id)+'" class="qtyInCart" />'
          + '    <button class="btnDel" data-del="'+escapeHtml(id)+'">Hiq</button>'
          + '  </div>'
          + '</div>';
      }
      cartItemsEl.innerHTML = html;

      var inputs = cartItemsEl.querySelectorAll(".qtyInCart");
      for (i=0;i<inputs.length;i++){
        (function(inp){
          inp.addEventListener("input", function(){
            var pid = inp.getAttribute("data-id");
            var v = Math.max(1, toNumber(inp.value || 1));
            if (CART[pid]) CART[pid].qty = v;
            calcTotals();
          });
        })(inputs[i]);
      }

      var dels = cartItemsEl.querySelectorAll("[data-del]");
      for (i=0;i<dels.length;i++){
        (function(btn){
          btn.addEventListener("click", function(){
            var pid = btn.getAttribute("data-del");
            delete CART[pid];
            renderCart();
          });
        })(dels[i]);
      }

      calcTotals();
    }

    function addToCart(row, qty){
      var id = String(row.id || row[COL_CODE] || firstExisting(row, NAME_KEYS));
      var q = Math.max(1, toNumber(qty || 1));
      if (!CART[id]) CART[id] = { row: row, qty: q };
      else CART[id].qty = Math.max(1, toNumber(CART[id].qty || 1) + q);
      renderCart();
    }

    function renderProducts(){
      clearError();

      var q = safeTrim(elQ.value).toLowerCase();
      var cat = safeTrim(elCat.value);
      var rate = DEFAULT_RATE;

      // filtro
      var filtered = [];
      var i, r, name, category, code, hay;
      for (i=0;i<ALL.length;i++){
        r = ALL[i] || {};
        category = safeTrim(r[COL_CATEGORY]);
        if (cat && category !== cat) continue;

        if (q){
          name = String(firstExisting(r, NAME_KEYS) || "").toLowerCase();
          code = String(r[COL_CODE] || "").toLowerCase();
          hay = (name + " " + category.toLowerCase() + " " + code);
          if (hay.indexOf(q) === -1) continue;
        }
        filtered.push(r);
      }

      elCount.textContent = filtered.length + " artikuj";

      // render
      var html = "";
      var desc, img, stock, priceLek, priceEur, oldLek, oldEur, hasOffer, pct;
      for (i=0;i<filtered.length;i++){
        r = filtered[i] || {};
        name = firstExisting(r, NAME_KEYS) || "(pa emÃ«r)";
        desc = firstExisting(r, DESC_KEYS) || "";
        img = firstExisting(r, IMG_KEYS) || "";
        category = safeTrim(r[COL_CATEGORY]);
        code = safeTrim(r[COL_CODE]);
        stock = safeTrim(r[COL_STOCK]);

        priceLek = toNumber(r[COL_PRICELEK]);
        priceEur = priceLek / rate;

        // OFERTÃ‹: vetÃ«m nÃ«se ke old_price_lek (ose alternativat) dhe Ã«shtÃ« > cmimi i ri
        oldLek = getOldPriceLek(r);
        hasOffer = (oldLek > 0 && oldLek > priceLek);
        oldEur = oldLek / rate;

        pct = 0;
        if (hasOffer){
          pct = Math.round(((oldLek - priceLek) / oldLek) * 100);
          if (pct < 1) pct = 1;
          if (pct > 99) pct = 99;
        }

        var imgHtml = '';
        if (img){
          imgHtml = '<div class="img"><img src="'+escapeHtml(img)+'" alt="'+escapeHtml(name)+'" loading="lazy" onerror="this.parentNode.style.background=\'#e5e7eb\'; this.style.display=\'none\';" /></div>';
        } else {
          imgHtml = '<div class="img"></div>';
        }

        var pid = escapeHtml(String(r.id || code || name));

        html += ''
          + '<article class="card">'
          +   imgHtml
          + ' <div class="content">'
          + '   <div class="nameRow">'
          + '     <h3 class="name">'+escapeHtml(name)+'</h3>'
          +       (hasOffer ? '<span class="badgeOffer">OFERTÃ‹</span>' : '')
          + '   </div>'
          + '   <div class="meta">'
          +     (category ? ('Kategoria: <b>'+escapeHtml(category)+'</b><br>') : '')
          +     (code ? ('Kodi: <b>'+escapeHtml(code)+'</b><br>') : '')
          +     (stock ? ('Stok: <b>'+escapeHtml(stock)+'</b>') : '')
          + '   </div>'
          + '   <div class="price">'
          + '     <div class="priceLeft">'
          + '       <div class="lek">'+formatLek(priceLek)+' LekÃ«</div>'
          + '       <div class="eur">'+formatEuro(priceEur)+' â‚¬</div>'
          +         (hasOffer ? ('<div class="oldPrice">'+formatLek(oldLek)+' LekÃ« ('+formatEuro(oldEur)+' â‚¬)</div>') : '')
          + '     </div>'
          +       (hasOffer ? ('<div class="discountPct">(ulje '+pct+'%)</div>') : '')
          + '   </div>'
          +     (desc ? ('<div class="desc">'+escapeHtml(desc)+'</div>') : '')
          + '   <div class="buyrow">'
          + '     <input class="qty" type="number" min="1" step="1" value="1" id="qty_'+pid+'" />'
          + '     <button class="btnAdd" data-add="'+pid+'">Shto nÃ« shportÃ«</button>'
          + '   </div>'
          + ' </div>'
          + '</article>';
      }

      elCards.innerHTML = html || "<div style='padding:12px;color:#64748b;font-weight:bold'>Nuk ka produkte pÃ«r kÃ«tÃ« filtÃ«r.</div>";

      // bind add buttons
      var btns = elCards.querySelectorAll("[data-add]");
      for (i=0;i<btns.length;i++){
        (function(btn){
          btn.addEventListener("click", function(){
            var pid = btn.getAttribute("data-add");
            var qtyEl = document.getElementById("qty_" + pid);
            var qty = Math.max(1, toNumber(qtyEl ? qtyEl.value : 1));

            // gjej rreshtin e duhur
            var row = null;
            var j, rr, rid, rcode, rname;
            for (j=0;j<filtered.length;j++){
              rr = filtered[j];
              rid = String(rr.id || "");
              rcode = String(rr[COL_CODE] || "");
              rname = String(firstExisting(rr, NAME_KEYS) || "");
              if ((rid && rid === pid) || (rcode && rcode === pid) || (rname && rname === pid)){
                row = rr; break;
              }
            }
            if (row) addToCart(row, qty);
          });
        })(btns[i]);
      }

      calcTotals();
    }

    function buildWhatsAppMessage(){
      var t = calcTotals();
      var note = safeTrim(noteEl.value);
      var lines = [];
      lines.push("ðŸ“Œ KÃ«rkesÃ« nga Katalogu â€” Gjekaj Plants");
      lines.push("");

      var id, it, r, name, code, priceLek, qty, subLek, subEur;
      for (id in CART) if (CART.hasOwnProperty(id)){
        it = CART[id];
        r = it.row || {};
        name = firstExisting(r, NAME_KEYS) || "(pa emÃ«r)";
        code = safeTrim(r[COL_CODE]);
        priceLek = toNumber(r[COL_PRICELEK]);
        qty = Math.max(1, toNumber(it.qty || 1));
        subLek = priceLek * qty;
        subEur = subLek / t.rate;

        lines.push("â€¢ " + name + (code ? " (Kodi: " + code + ")" : ""));
        lines.push("  Sasia: " + qty + " | NÃ«n-total: " + formatLek(subLek) + " LekÃ« (" + formatEuro(subEur) + " â‚¬)");
      }

      lines.push("");
      lines.push("Totali: " + formatLek(t.totalLek) + " LekÃ« (" + formatEuro(t.totalEur) + " â‚¬)");
      lines.push("Kursi: 1â‚¬ = " + t.rate + " Lek");

      if (note){
        lines.push("");
        lines.push("ShÃ«nim:");
        lines.push(note);
      }
      return lines.join("\n");
    }

    function loadProducts(){
      clearError();
      elStatus.textContent = "Duke lexuar nga Supabaseâ€¦";

      // vendos kursin default (vetÃ«m shfaqje)
      elRate.value = DEFAULT_RATE;

      if (!SUPABASE_ANON_KEY || SUPABASE_ANON_KEY === "VENDOS_ANON_KEY_KETU"){
        showError("Sâ€™ke vendosur ANON KEY.\nVendos Ã§elÃ«sin qÃ« fillon me eyJ... te SUPABASE_ANON_KEY.");
        elStatus.textContent = "Gabim";
        return;
      }

      // REST endpoint
      var url = SUPABASE_URL + "/rest/v1/" + encodeURIComponent(TABLE) + "?select=*";

      var xhr = new XMLHttpRequest();
      xhr.open("GET", url, true);
      xhr.setRequestHeader("apikey", SUPABASE_ANON_KEY);
      xhr.setRequestHeader("Authorization", "Bearer " + SUPABASE_ANON_KEY);
      xhr.setRequestHeader("Accept", "application/json");

      xhr.onreadystatechange = function(){
        if (xhr.readyState !== 4) return;

        if (xhr.status >= 200 && xhr.status < 300){
          try{
            ALL = JSON.parse(xhr.responseText) || [];
          }catch(e){
            showError("Gabim te JSON: " + e);
            elStatus.textContent = "Gabim";
            return;
          }
          buildCategories(ALL);
          renderProducts();
          elStatus.textContent = "Gati.";
          return;
        }

        showError(
          "Gabim Supabase ("+xhr.status+").\n\n" +
          (xhr.responseText || "") +
          "\n\nKontrollo: RLS SELECT pÃ«r anon/public te tabela products."
        );
        elStatus.textContent = "Gabim";
      };

      xhr.onerror = function(){
        showError("Gabim rrjeti. Kontrollo internetin / SSL / bllokime.");
        elStatus.textContent = "Gabim";
      };

      xhr.send();
    }

    // Events
    elQ.addEventListener("input", renderProducts);
    elCat.addEventListener("change", renderProducts);
    noteEl.addEventListener("input", saveCart);

    clearCartBtn.addEventListener("click", function(){
      if (!confirm("Me e pastru shportÃ«n komplet?")) return;
      CART = {};
      noteEl.value = "";
      renderCart();
    });

    sendWA.addEventListener("click", function(){
      var msg = buildWhatsAppMessage();
      var url = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(msg);
      window.open(url, "_blank");
    });

    // Start
    loadCart();
    renderCart();
    loadProducts();
  </script>
</body>
</html>
