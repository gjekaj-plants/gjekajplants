<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- âœ… SEO (SHTUAR) -->
  <title>Fidan & PemÃ« Dekorative nÃ« DajÃ§, ShkodÃ«r | Gjekaj Plants</title>
  <meta name="description" content="Gjekaj Plants nÃ« DajÃ§, ShkodÃ«r â€“ fidan dekorative, pemÃ« dekorative, lule dekorative, shkurre dhe bimÃ« pÃ«r oborr e kopÃ«sht. Shiko katalogun online dhe porosit nÃ« WhatsApp." />
  <meta name="keywords" content="fidan dekorative, pemÃ« dekorative, lule dekorative, fidan DajÃ§, fidan ShkodÃ«r, pemÃ« dekorative DajÃ§, pemÃ« dekorative ShkodÃ«r, bimÃ« dekorative, fidane pemÃ«sh, kopshtari ShkodÃ«r, Gjekaj Plants" />
  <meta name="author" content="Gjekaj Plants, DajÃ§ ShkodÃ«r" />
  <meta name="robots" content="index, follow" />
  <meta name="language" content="sq" />

  <style>
    :root{
      --bg:#f3f5f8;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --accent:#b91c1c;
      --border:#e5e7eb;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --radius: 18px;
      --dark:#0b1220;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header{
      background: linear-gradient(180deg, #0b1220 0%, #111827 100%);
      color:#fff;
      padding: 22px 16px 18px;
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom: 1px solid rgba(255,255,255,.08);
      text-align:center;
    }
    header h1{
      margin:0;
      font-size: clamp(20px, 3.6vw, 32px);
      font-weight: 900;
      line-height: 1.15;
    }
    header .sub{
      margin-top:8px;
      opacity:.9;
      font-size: 14px;
      font-weight: 650;
    }

    .wrap{
      max-width: 1200px;
      margin: 18px auto 90px;
      padding: 0 14px;
    }

    .panel{
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 14px;
      margin-top: 14px;
    }

    .grid-controls{
      display:grid;
      grid-template-columns: 1.3fr .8fr .9fr;
      gap: 10px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid-controls{ grid-template-columns: 1fr; }
    }

    label{
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      display:block;
      margin: 6px 0 6px;
    }
    input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border:1px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      outline: none;
      background:#fff;
    }
    textarea{ min-height: 70px; resize: vertical; }

    .bar{
      display:flex;
      justify-content: space-between;
      align-items:center;
      margin-top: 14px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .count{
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
    }
    .status{
      font-size: 13px;
      font-weight: 900;
      color: var(--muted);
    }
    .error{
      display:none;
      margin-top: 14px;
      background: #fff;
      border: 1px solid #fecaca;
      border-left: 6px solid #b91c1c;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 900;
      color:#7f1d1d;
      white-space: pre-wrap;
    }

    /* Cards */
    .cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 1020px){ .cards{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 640px){ .cards{grid-template-columns: 1fr;} }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 100%;
    }
    .img{
      width:100%;
      aspect-ratio: 16/10;
      background: #e5e7eb;
      display:block;
      object-fit: cover;
    }
    .content{
      padding: 12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      flex:1;
    }
    .name{
      margin:0;
      font-size: 20px;
      font-weight: 950;
    }
    .meta{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      font-weight: 700;
    }
    .price{
      display:flex;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
    }
    .lek{
      color: var(--accent);
      font-weight: 1000;
      font-size: 26px;
    }
    .eur{
      color: #334155;
      font-weight: 950;
      font-size: 18px;
    }
    .desc{
      color:#334155;
      font-size: 13px;
      line-height:1.35;
      font-weight: 650;
      opacity:.95;
    }
    .buyrow{
      display:flex;
      gap: 10px;
      align-items:center;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .qty{ width: 90px; }
    .btnAdd{
      flex:1;
      min-width: 160px;
      background: #111827;
      color: #fff;
      border: 0;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1000;
      cursor:pointer;
      font-size: 15px;
    }

    .rateCartCol{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    /* CART sticky */
    .cartbox{
      background: var(--dark);
      color:#fff;
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 16px 45px rgba(2,6,23,.18);
    }
    .rateCartCol .cartbox{
      position: sticky;
      top: 96px;
      max-height: calc(100vh - 140px);
      overflow: auto;
      z-index: 40;
    }
    .cartbox h2{
      margin: 4px 0 10px;
      font-size: 16px;
      font-weight: 1000;
    }
    .cartlist{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .cartitem{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 10px;
      display:grid;
      grid-template-columns: 1fr 86px;
      gap: 10px;
      align-items:start;
    }
    .cartitem .t{ font-weight: 1000; font-size: 13.5px; }
    .cartitem .s{ margin-top: 4px; font-size: 12.5px; opacity:.9; }
    .cartitem .q{ display:flex; flex-direction:column; gap: 8px; }
    .cartitem input{
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight: 1000;
      text-align:center;
    }
    .btnDel{
      width:100%;
      border:0;
      border-radius: 12px;
      padding: 10px 10px;
      cursor:pointer;
      font-weight: 1000;
      background: rgba(244,63,94,.22);
      color:#fff;
    }

    .totals{
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }
    .totals .big{ font-size: 20px; font-weight: 1100; }
    .totals .small{ font-size: 14px; font-weight: 1000; opacity:.95; }

    .note{ margin-top: 10px; }
    .note textarea{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color:#fff;
    }

    .cartActions{
      display:flex;
      gap: 10px;
      margin-top: 10px;
    }
    .btnClear{
      width: 100%;
      background: rgba(255,255,255,.10);
      color:#fff;
      border:1px solid rgba(255,255,255,.20);
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1100;
      cursor:pointer;
      font-size: 15px;
    }
    .send{
      margin-top: 10px;
      width:100%;
      background:#16a34a;
      color:#fff;
      border:0;
      border-radius: 14px;
      padding: 13px 12px;
      font-weight: 1100;
      cursor:pointer;
      font-size: 16px;
    }
    .send:disabled{ opacity:.55; cursor:not-allowed; }

    footer{
      position: fixed;
      left:0; right:0; bottom:0;
      background: #111827;
      color:#fff;
      padding: 10px 14px;
      text-align:center;
      font-weight: 1000;
      z-index: 40;
    }
  </style>
</head>

<body>
  <header>
    <h1>Gjekaj Plants â€” Katalogu i BimÃ«ve</h1>
    <div class="sub">DajÃ§, ShkodÃ«r, Albania â€¢ Tel: +355697232425</div>
  </header>

  <!-- âœ… SEO tekst (SHTUAR) -->
  <section style="max-width:1100px;margin:20px auto;padding:0 12px;color:#334155;font-size:14px">
    <h2>Fidan dhe PemÃ« Dekorative nÃ« DajÃ§, ShkodÃ«r Albania </h2>
    <p>
      Gjekaj Plants ofron fidan dekorative, pemÃ« dekorative, lule dekorative dhe bimÃ« pÃ«r oborr
      dhe kopshte. Katalogu ynÃ« ofron njÃ« gamÃ« tÃ« gjerÃ« tÃ« pemÃ«ve dhe bimÃ«ve,nga fidanet,pemet dekorative,
      shkurre dekorative,MUNDESI TRANSPORTIT, BMJEDHJE RREGULLIM OBORRI VILA HTELE RESORANTE E,TJE.. 
    </p>
  </section>

  <div class="wrap">
    <div id="err" class="error"></div>

    <div class="panel">
      <div class="grid-controls">
        <div>
          <label>KÃ«rko (emÃ«r / kategori / kod)</label>
          <input id="q" placeholder="p.sh. cipresus, 019, dekorative..." />
        </div>

        <div>
          <label>Kategori</label>
          <select id="cat">
            <option value="">TÃ« gjitha kategoritÃ«</option>
          </select>
        </div>

        <div class="rateCartCol">
          <div>
            <label>Kursi â‚¬ â†’ Lek (1â‚¬ = 97)</label>
            <input id="rate" type="number" inputmode="numeric" min="1" step="1" value="97" />
          </div>

          <div class="cartbox" id="cartBox">
            <h2>Shporta</h2>
            <div id="cartItems" class="cartlist"></div>

            <div class="totals">
              <div class="big" id="cartTotalLek">0 LekÃ«</div>
              <div class="small" id="cartTotalEur">0.00 â‚¬</div>
            </div>

            <div class="note">
              <label style="color: rgba(255,255,255,.85); font-weight:1000">ShÃ«nim (opsionale)</label>
              <textarea id="note" placeholder="p.sh. dÃ«rgesÃ« / orari / kÃ«rkesa speciale..."></textarea>
            </div>

            <div class="cartActions">
              <button id="clearCart" class="btnClear" type="button">Pastro shportÃ«n</button>
            </div>

            <button id="sendWA" class="send" disabled>DÃ«rgo nÃ« WhatsApp</button>
          </div>
        </div>
      </div>

      <div class="bar">
        <div class="count" id="count">0 artikuj</div>
        <div class="status" id="status">Duke u lidhurâ€¦</div>
      </div>
    </div>

    <div class="cards" id="cards"></div>
  </div>

  <footer>Gjekaj Plants â€¢ WhatsApp: 0697232425</footer>

  <script>
    // =========================
    // âœ… SUPABASE SETTINGS
    // =========================
    var SUPABASE_URL = "https://oehcfyfjlwvlqowjezwg.supabase.co";
  var SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9laGNmeWZqbHd2bHFvd2plendnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTU4NDEsImV4cCI6MjA4NTYzMTg0MX0.J3veeWRfwHhJOoMwBHwA2qQdQiXdqzGORDn8j0hR7Rk";
    var TABLE = "products";

    // WhatsApp (pa +)
    var WHATSAPP_NUMBER = "355697232425";

    // Kolonat (siÃ§ i ke nÃ« tabelÃ«)
    var COL_CATEGORY = "category";
    var COL_CODE     = "code";
    var COL_STOCK    = "stock";
    var COL_PRICELEK = "price_lek";

    // Foto (provo kÃ«to fusha derisa tÃ« pÃ«rputhet me tabelÃ«n tÃ«nde)
    var IMG_KEYS  = ["photo_url","image_url","img_url","photo","image","foto","url_photo","url_image"];
    var NAME_KEYS = ["name","title","emri"];
    var DESC_KEYS = ["description","desc","pershkrimi","pershkrim"];

    // UI
    var elErr = document.getElementById("err");
    var elCards = document.getElementById("cards");
    var elCount = document.getElementById("count");
    var elStatus = document.getElementById("status");
    var elQ = document.getElementById("q");
    var elCat = document.getElementById("cat");
    var elRate = document.getElementById("rate");

    var cartItemsEl = document.getElementById("cartItems");
    var cartTotalLekEl = document.getElementById("cartTotalLek");
    var cartTotalEurEl = document.getElementById("cartTotalEur");
    var noteEl = document.getElementById("note");
    var clearCartBtn = document.getElementById("clearCart");
    var sendWA = document.getElementById("sendWA");

    function showError(msg){
      elErr.style.display = "block";
      elErr.textContent = msg;
    }
    function clearError(){
      elErr.style.display = "none";
      elErr.textContent = "";
    }
    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function firstExisting(row, keys){
      for (var i=0;i<keys.length;i++){
        var k = keys[i];
        if (row && row[k] !== undefined && row[k] !== null && String(row[k]).trim() !== "") return row[k];
      }
      return "";
    }
    function toNumber(v){
      if (v === null || v === undefined) return 0;
      var s = String(v).replaceAll(".", "").replaceAll(",", ".").replace(/[^\d.]/g, "");
      var n = Number(s);
      return Number.isFinite(n) ? n : 0;
    }
    function formatLek(n){
      var x = Math.round(n);
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
    function formatEuro(n){
      return (Math.round(n * 100) / 100).toFixed(2);
    }

    // Data
    var ALL = [];
    var CART = {}; // {id: {row, qty}}

    function saveCart(){
      try{
        localStorage.setItem("gjekaj_cart_final", JSON.stringify({ cart: CART, note: noteEl.value || "" }));
      }catch(e){}
    }
    function loadCart(){
      try{
        var raw = localStorage.getItem("gjekaj_cart_final");
        if (!raw) return;
        var obj = JSON.parse(raw);
        CART = (obj && obj.cart) ? obj.cart : {};
        noteEl.value = (obj && obj.note) ? obj.note : "";
      }catch(e){}
    }

    function buildCategories(rows){
      var set = {};
      for (var i=0;i<rows.length;i++){
        var r = rows[i] || {};
        var c = (r[COL_CATEGORY] ?? "").toString().trim();
        if (c) set[c] = true;
      }
      var cats = Object.keys(set).sort(function(a,b){ return a.localeCompare(b); });
      var current = elCat.value;

      var html = '<option value="">TÃ« gjitha kategoritÃ«</option>';
      for (var j=0;j<cats.length;j++){
        html += '<option value="'+escapeHtml(cats[j])+'">'+escapeHtml(cats[j])+'</option>';
      }
      elCat.innerHTML = html;
      if (current && cats.indexOf(current) !== -1) elCat.value = current;
    }

    function calcTotals(){
      var rate = Math.max(1, toNumber(elRate.value || 97));
      var totalLek = 0;

      Object.keys(CART).forEach(function(id){
        var it = CART[id];
        var priceLek = toNumber(it && it.row ? it.row[COL_PRICELEK] : 0);
        var qty = Math.max(1, toNumber(it && it.qty ? it.qty : 1));
        totalLek += priceLek * qty;
      });

      var totalEur = totalLek / rate;
      cartTotalLekEl.textContent = formatLek(totalLek) + " LekÃ«";
      cartTotalEurEl.textContent = formatEuro(totalEur) + " â‚¬";
      sendWA.disabled = totalLek <= 0;

      saveCart();
      return { totalLek: totalLek, totalEur: totalEur, rate: rate };
    }

    function renderCart(){
      var ids = Object.keys(CART);
      if (ids.length === 0){
        cartItemsEl.innerHTML = '<div style="opacity:.9;font-weight:900;">Shporta Ã«shtÃ« bosh.</div>';
        calcTotals();
        return;
      }

      var html = "";
      for (var i=0;i<ids.length;i++){
        var id = ids[i];
        var it = CART[id];
        var r = it.row || {};
        var name = firstExisting(r, NAME_KEYS) || "(pa emÃ«r)";
        var category = (r[COL_CATEGORY] ?? "").toString();
        var code = (r[COL_CODE] ?? "").toString();
        var priceLek = toNumber(r[COL_PRICELEK]);
        var qty = Math.max(1, toNumber(it.qty || 1));

        html += ''
          + '<div class="cartitem">'
          + '  <div>'
          + '    <div class="t">'+escapeHtml(name)+'</div>'
          + '    <div class="s">'
          + (category ? ('Kategoria: <b>'+escapeHtml(category)+'</b><br>') : '')
          + (code ? ('Kodi: <b>'+escapeHtml(code)+'</b><br>') : '')
          + 'Ã‡mimi: <b>'+formatLek(priceLek)+' LekÃ«</b>'
          + '    </div>'
          + '  </div>'
          + '  <div class="q">'
          + '    <input type="number" min="1" step="1" value="'+qty+'" data-id="'+escapeHtml(id)+'" class="qtyInCart" />'
          + '    <button class="btnDel" data-del="'+escapeHtml(id)+'">Hiq</button>'
          + '  </div>'
          + '</div>';
      }
      cartItemsEl.innerHTML = html;

      Array.prototype.forEach.call(cartItemsEl.querySelectorAll(".qtyInCart"), function(inp){
        inp.addEventListener("input", function(){
          var id = inp.getAttribute("data-id");
          var v = Math.max(1, toNumber(inp.value || 1));
          if (CART[id]) CART[id].qty = v;
          calcTotals();
        });
      });
      Array.prototype.forEach.call(cartItemsEl.querySelectorAll("[data-del]"), function(btn){
        btn.addEventListener("click", function(){
          var id = btn.getAttribute("data-del");
          delete CART[id];
          renderCart();
        });
      });

      calcTotals();
    }

    function addToCart(row, qty){
      var id = String(row.id ?? row[COL_CODE] ?? firstExisting(row, NAME_KEYS));
      var q = Math.max(1, toNumber(qty || 1));
      if (!CART[id]) CART[id] = { row: row, qty: q };
      else CART[id].qty = Math.max(1, toNumber(CART[id].qty || 1) + q);
      renderCart();
    }

    function renderProducts(){
      clearError();
      var q = (elQ.value || "").trim().toLowerCase();
      var cat = (elCat.value || "").trim();
      var rate = Math.max(1, toNumber(elRate.value || 97));

      var filtered = ALL.filter(function(r){
        if (cat && String(r[COL_CATEGORY] ?? "").trim() !== cat) return false;
        if (!q) return true;

        var name = String(firstExisting(r, NAME_KEYS) || "").toLowerCase();
        var category = String(r[COL_CATEGORY] ?? "").toLowerCase();
        var code = String(r[COL_CODE] ?? "").toLowerCase();
        return name.indexOf(q) !== -1 || category.indexOf(q) !== -1 || code.indexOf(q) !== -1;
      });

      elCount.textContent = filtered.length + " artikuj";

      var html = "";
      for (var i=0;i<filtered.length;i++){
        var r = filtered[i];
        var name = firstExisting(r, NAME_KEYS) || "(pa emÃ«r)";
        var desc = firstExisting(r, DESC_KEYS) || "";
        var img = firstExisting(r, IMG_KEYS) || "";
        var category = String(r[COL_CATEGORY] ?? "");
        var code = String(r[COL_CODE] ?? "");
        var stock = String(r[COL_STOCK] ?? "");
        var priceLek = toNumber(r[COL_PRICELEK]);
        var priceEur = priceLek / rate;

        var imgTag = img
          ? '<img class="img" src="'+escapeHtml(img)+'" alt="'+escapeHtml(name)+'" loading="lazy" onerror="this.style.display=\'none\'; this.parentNode.style.background=\'#e5e7eb\';" />'
          : '<div class="img"></div>';

        var pid = escapeHtml(String(r.id ?? code ?? name));

        html += ''
          + '<article class="card">'
          +   imgTag
          + ' <div class="content">'
          + '   <h3 class="name">'+escapeHtml(name)+'</h3>'
          + '   <div class="meta">'
          +     (category ? ('Kategoria: <b>'+escapeHtml(category)+'</b><br>') : '')
          +     (code ? ('Kodi: <b>'+escapeHtml(code)+'</b><br>') : '')
          +     (stock ? ('Stok: <b>'+escapeHtml(stock)+'</b>') : '')
          + '   </div>'
          + '   <div class="price">'
          + '     <div class="lek">'+formatLek(priceLek)+' LekÃ«</div>'
          + '     <div class="eur">'+formatEuro(priceEur)+' â‚¬</div>'
          + '   </div>'
          +     (desc ? ('<div class="desc">'+escapeHtml(desc)+'</div>') : '')
          + '   <div class="buyrow">'
          + '     <input class="qty" type="number" min="1" step="1" value="1" id="qty_'+pid+'" />'
          + '     <button class="btnAdd" data-add="'+pid+'">Shto nÃ« shportÃ«</button>'
          + '   </div>'
          + ' </div>'
          + '</article>';
      }
      elCards.innerHTML = html;

      Array.prototype.forEach.call(elCards.querySelectorAll("[data-add]"), function(btn){
        btn.addEventListener("click", function(){
          var pid = btn.getAttribute("data-add");
          var qtyEl = document.getElementById("qty_" + pid);
          var qty = Math.max(1, toNumber(qtyEl && qtyEl.value ? qtyEl.value : 1));

          var row = null;
          for (var i=0;i<filtered.length;i++){
            var r = filtered[i];
            var rid = String(r.id ?? "");
            var rcode = String(r[COL_CODE] ?? "");
            var rname = String(firstExisting(r, NAME_KEYS) ?? "");
            if ((rid && rid === pid) || (rcode && rcode === pid) || (rname && rname === pid)){
              row = r; break;
            }
          }
          if (row) addToCart(row, qty);
        });
      });

      calcTotals();
    }

    function buildWhatsAppMessage(){
      var t = calcTotals();
      var note = (noteEl.value || "").trim();
      var lines = [];
      lines.push("ðŸ“Œ KÃ«rkesÃ« nga Katalogu â€” Gjekaj Plants");
      lines.push("");

      Object.keys(CART).forEach(function(id){
        var it = CART[id];
        var r = it.row || {};
        var name = firstExisting(r, NAME_KEYS) || "(pa emÃ«r)";
        var code = String(r[COL_CODE] ?? "");
        var priceLek = toNumber(r[COL_PRICELEK]);
        var qty = Math.max(1, toNumber(it.qty || 1));
        var subLek = priceLek * qty;
        var subEur = subLek / t.rate;

        lines.push("â€¢ " + name + (code ? " (Kodi: " + code + ")" : ""));
        lines.push("  Sasia: " + qty + " | NÃ«n-total: " + formatLek(subLek) + " LekÃ« (" + formatEuro(subEur) + " â‚¬)");
      });

      lines.push("");
      lines.push("Totali: " + formatLek(t.totalLek) + " LekÃ« (" + formatEuro(t.totalEur) + " â‚¬)");
      lines.push("Kursi: 1â‚¬ = " + t.rate + " Lek");

      if (note){
        lines.push("");
        lines.push("ShÃ«nim:");
        lines.push(note);
      }
      return lines.join("\n");
    }

    function loadProducts(){
      clearError();
      elStatus.textContent = "Duke lexuar nga Supabaseâ€¦";

      if (!SUPABASE_ANON_KEY || SUPABASE_ANON_KEY.indexOf("VENDOS_ANON_KEY_KETU") !== -1){
        showError("Sâ€™ke vendosur ANON KEY.\nHap kodin dhe vendos Ã§elÃ«sin qÃ« fillon me eyJ... te SUPABASE_ANON_KEY.");
        elStatus.textContent = "Gabim";
        return;
      }

      var url = SUPABASE_URL + "/rest/v1/" + encodeURIComponent(TABLE) + "?select=*";
      var xhr = new XMLHttpRequest();
      xhr.open("GET", url, true);
      xhr.setRequestHeader("apikey", SUPABASE_ANON_KEY);
      xhr.setRequestHeader("Authorization", "Bearer " + SUPABASE_ANON_KEY);
      xhr.setRequestHeader("Accept", "application/json");

      xhr.onreadystatechange = function(){
        if (xhr.readyState !== 4) return;

        if (xhr.status >= 200 && xhr.status < 300){
          try{
            ALL = JSON.parse(xhr.responseText) || [];
          }catch(e){
            showError("Gabim te JSON: " + e);
            elStatus.textContent = "Gabim";
            return;
          }
          buildCategories(ALL);
          renderProducts();
          elStatus.textContent = "Gati.";
          return;
        }

        showError(
          "Gabim Supabase ("+xhr.status+").\n\n" +
          (xhr.responseText || "") +
          "\n\nKontrollo: RLS SELECT pÃ«r anon/public te tabela products."
        );
        elStatus.textContent = "Gabim";
      };

      xhr.onerror = function(){
        showError("Gabim rrjeti. Kontrollo internetin / SSL / bllokime.");
        elStatus.textContent = "Gabim";
      };

      xhr.send();
    }

    // Events
    elQ.addEventListener("input", renderProducts);
    elCat.addEventListener("change", renderProducts);
    elRate.addEventListener("input", function(){ renderProducts(); renderCart(); });
    noteEl.addEventListener("input", saveCart);

    clearCartBtn.addEventListener("click", function(){
      if (!confirm("Me e pastru shportÃ«n komplet?")) return;
      CART = {};
      noteEl.value = "";
      renderCart();
    });

    sendWA.addEventListener("click", function(){
      var msg = buildWhatsAppMessage();
      var url = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(msg);
      window.open(url, "_blank");
    });

    // Start
    loadCart();
    renderCart();
    loadProducts();
  </script>
</body>
</html>
