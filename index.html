<!doctype html>
<html lang="sq">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gjekaj Plants — Katalogu i Bimëve</title>

<style>
body{margin:0;font-family:system-ui,Arial;background:#f3f5f8;color:#0f172a}
header{background:#111827;color:#fff;padding:18px;text-align:center}
.wrap{max-width:1200px;margin:16px auto;padding:0 12px}
.panel{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:12px}
.row{display:flex;gap:10px;flex-wrap:wrap}
input,select{padding:10px;border:1px solid #e5e7eb;border-radius:10px}
#q{flex:1;min-width:220px}
.cards{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
@media(max-width:900px){.cards{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.cards{grid-template-columns:1fr}}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden}
.card img{width:100%;height:200px;object-fit:cover;background:#e5e7eb}
.c{padding:12px}
.name{font-size:18px;font-weight:800}
.meta{font-size:13px;color:#64748b}
.price{margin-top:6px;font-size:20px;font-weight:900;color:#b91c1c}
.eur{font-size:14px;color:#334155;font-weight:700}
button{margin-top:8px;width:100%;padding:10px;border:0;border-radius:10px;background:#111827;color:#fff;font-weight:800;cursor:pointer}
.cart{position:fixed;right:12px;bottom:12px;background:#111827;color:#fff;border-radius:14px;padding:12px;width:280px}
.cart h3{margin:0 0 8px}
</style>
</head>

<body>

<header>
<h2>Gjekaj Plants — Katalogu i Bimëve</h2>
<div>Dajç, Shkodër • Tel: +355697232425</div>
</header>

<div class="wrap">
<div class="panel">
<div class="row">
<input id="q" placeholder="Kërko (emër / kategori / kod)">
<select id="cat"><option value="">Të gjitha kategoritë</option></select>
</div>
<div id="status">Duke u lidhur…</div>
</div>

<div id="cards" class="cards"></div>
</div>

<div class="cart">
<h3>Shporta</h3>
<div id="cartItems">Bosh</div>
<div id="total">0 Lekë</div>
</div>

<script>
const SUPABASE_URL = "https://oehcfyfjlwvlqowjezwg.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9laGNmeWZqbHd2bHFvd2plendnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTU4NDEsImV4cCI6MjA4NTYzMTg0MX0.J3veeWRfwHhJOoMwBHwA2qQdQiXdqzGORDn8j0hR7Rk"; // ⬅️ VETËM KËTU
const TABLE = "products";
const RATE = 97;

let ALL=[], CART={};

const q=document.getElementById("q");
const cat=document.getElementById("cat");
const cards=document.getElementById("cards");
const status=document.getElementById("status");
const cartItems=document.getElementById("cartItems");
const total=document.getElementById("total");

function esc(s){return String(s||"").replace(/[&<>"]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[m]))}

function render(){
let f=ALL.filter(p=>{
if(cat.value && p.category!==cat.value) return false;
let t=(p.name+" "+p.category+" "+p.code).toLowerCase();
return t.includes(q.value.toLowerCase());
});
status.textContent="Gati ("+f.length+" artikuj)";
cards.innerHTML=f.map(p=>`
<div class="card">
${p.photo_url?<img src="${esc(p.photo_url)}">:""}
<div class="c">
<div class="name">${esc(p.name)}</div>
<div class="meta">Kategoria: ${esc(p.category)}<br>Kodi: ${esc(p.code)}</div>
<div class="price">${p.price_lek} Lekë <span class="eur">(${(p.price_lek/RATE).toFixed(2)} €)</span></div>
<button onclick="add(${p.id})">Shto në shportë</button>
</div>
</div>`).join("");
}

function add(id){
CART[id]=(CART[id]||0)+1;
updateCart();
}

function updateCart(){
let sum=0, html="";
for(let id in CART){
let p=ALL.find(x=>x.id==id);
sum+=p.price_lek*CART[id];
html+=<div>${p.name} × ${CART[id]}</div>;
}
cartItems.innerHTML=html||"Bosh";
total.textContent=sum+" Lekë";
}

function load(){
fetch(SUPABASE_URL+"/rest/v1/"+TABLE+"?select=*",{headers:{
apikey:SUPABASE_ANON_KEY,
Authorization:"Bearer "+SUPABASE_ANON_KEY
}})
.then(r=>r.json())
.then(d=>{
ALL=d;
[...new Set(d.map(x=>x.category))].forEach(c=>{
let o=document.createElement("option");o.value=c;o.textContent=c;cat.appendChild(o);
});
render();
})
.catch(e=>status.textContent="Gabim Supabase");
}

q.oninput=render;
cat.onchange=render;
load();
</script>

</body>
</html>
